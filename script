local MacLib = loadstring(game:HttpGet("https://github.com/biggaboy212/Maclib/releases/latest/download/maclib.txt"))()

-- Create the main window
local Window = MacLib:Window({
    Title = "Night RBX",
    Subtitle = "BETA | V0.1",
    Size = UDim2.fromOffset(868, 650),
    DragStyle = 3, -- Full top-bar dragging for mobile
    DisabledWindowControls = {},
    ShowUserInfo = true,
    Keybind = Enum.KeyCode.RightControl,
    AcrylicBlur = true
})

-- Set config folder
MacLib:SetFolder("NightRBX_Configs")

-- Defer positioning until the frame is available
task.defer(function()
    if Window.Frame then
        Window.Frame.Position = UDim2.new(0.5, -434, 0.5, -325) -- Center based on size (868/2, 650/2)
        Window.Frame.AnchorPoint = Vector2.new(0.5, 0.5)
    else
        warn("Window.Frame not found; UI positioning may not work as expected.")
    end
end)

-- Create TabGroup
local TabGroup = Window:TabGroup()

-- Combat Tab
local CombatTab = TabGroup:Tab({
    Name = "Combat"
})
CombatTab:Select() -- Make Combat tab active by default

-- Config Tab
local ConfigTab = TabGroup:Tab({
    Name = "Config"
})

-- Combat Tab Sections
local CombatSections = {
    LeftTop = CombatTab:Section({Side = "Left"}),
    LeftBottom = CombatTab:Section({Side = "Left"}),
    RightTop = CombatTab:Section({Side = "Right"}),
    RightBottom = CombatTab:Section({Side = "Right"})
}

-- Config Tab Section
local ConfigSection = ConfigTab:Section({Side = "Left"})

-- Add Config Settings
ConfigSection:Button({
    Name = "Save Config",
    Callback = function()
        MacLib:SaveConfig("config")
        Window:Notify({
            Title = "Config",
            Description = "Settings saved"
        })
    end
})

ConfigSection:Button({
    Name = "Load Config",
    Callback = function()
        MacLib:LoadConfig("config")
        Window:Notify({
            Title = "Config",
            Description = "Settings loaded"
        })
    end
})

ConfigSection:Button({
    Name = "Refresh Config List",
    Callback = function()
        local configList = MacLib:RefreshConfigList()
        Window:Notify({
            Title = "Config List",
            Description = "Configs: " .. table.concat(configList, ", ")
        })
    end
})

ConfigSection:Button({
    Name = "Load Auto Config",
    Callback = function()
        MacLib:LoadAutoLoadConfig()
        Window:Notify({
            Title = "Auto Load",
            Description = "Autoload config applied"
        })
    end
})

-- Combat Sections Example Elements
CombatSections.LeftTop:Button({
    Name = "Attack",
    Callback = function()
        print("Attacking.")
        Window:Notify({
            Title = "Combat",
            Description = "Attack triggered"
        })
    end
})

CombatSections.LeftBottom:Slider({
    Name = "Attack Range",
    Default = 10,
    Minimum = 5,
    Maximum = 20,
    DisplayMethod = "Percent",
    Callback = function(Value: number)
        print("Attack range set to: " .. Value)
    end
}, "AttackRange")

CombatSections.RightTop:Toggle({
    Name = "Auto Attack",
    Default = false,
    Callback = function(value: boolean)
        Window:Notify({
            Title = "Auto Attack",
            Description = value and "Enabled" or "Disabled"
        })
    end
}, "AutoAttack")

CombatSections.RightBottom:Button({
    Name = "Use Skill",
    Callback = function()
        print("Using skill.")
        Window:Notify({
            Title = "Combat",
            Description = "Skill activated"
        })
    end
})

-- Create Toggle Button for Mobile Players
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UIToggleGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local ToggleButton = Instance.new("ImageButton")
ToggleButton.Size = UDim2.new(0, 50, 0, 50) -- Circular size
ToggleButton.Position = UDim2.new(0.5, -25, 0, 10) -- Centered at top
ToggleButton.AnchorPoint = Vector2.new(0.5, 0)
ToggleButton.BackgroundTransparency = 1
ToggleButton.Image = "" -- No image, relying on shape
ToggleButton.Parent = ScreenGui

-- Make it circular with UIStroke and UICorner
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0) -- Full circle
UICorner.Parent = ToggleButton

local UIStroke = Instance.new("UIStroke")
UIStroke.Thickness = 2
UIStroke.Color = Color3.fromRGB(255, 255, 255)
UIStroke.Parent = ToggleButton

ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50) -- Gray fill

-- Toggle UI visibility
local uiVisible = true
ToggleButton.MouseButton1Click:Connect(function()
    uiVisible = not uiVisible
    if Window.Frame then
        Window.Frame.Visible = uiVisible
        ToggleButton.BackgroundColor3 = uiVisible and Color3.fromRGB(50, 50, 50) or Color3.fromRGB(150, 150, 150) -- Color change for feedback
    else
        warn("Window.Frame not found; UI toggle may not work.")
    end
end)

-- Ensure mobile dragging works
local UserInputService = game:GetService("UserInputService")
local dragging = false
local dragStart: Vector2?
local startPos: UDim2?

UserInputService.InputBegan:Connect(function(input: InputObject, gameProcessed: boolean)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.Touch and input.Position and Window.Frame then
        local touchPos = Vector2.new(input.Position.X, input.Position.Y)
        local framePos = Window.Frame.AbsolutePosition
        local frameSize = Window.Frame.AbsoluteSize
        if touchPos.X >= framePos.X and touchPos.X <= framePos.X + frameSize.X and
           touchPos.Y >= framePos.Y and touchPos.Y <= framePos.Y + 50 then -- Top 50 studs
            dragging = true
            dragStart = touchPos
            startPos = Window.Frame.Position
        end
    end
end)

UserInputService.InputChanged:Connect(function(input: InputObject)
    if dragging and input.UserInputType == Enum.UserInputType.Touch and dragStart and startPos and Window.Frame then
        local touchPos = Vector2.new(input.Position.X, input.Position.Y)
        local delta = touchPos - dragStart
        Window.Frame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

UserInputService.InputEnded:Connect(function(input: InputObject)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
        dragStart = nil
        startPos = nil
    end
end)

-- Initial Config Load (optional)
MacLib:LoadConfig("config")
